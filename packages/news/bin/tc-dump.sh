#!/bin/sh
psql -h turing -U postgres -t -c "select * from ((select case when u1.train_topic_p then u1.classification__tree_sk else null end, case when u1.train_edition_p then u1.classification__edition_sk else null end, case when u1.creation_date > current_timestamp - '3 days'::interval then u1.classification__tree_sk else null end,  case when u1.creation_date > current_timestamp - '3 days'::interval then u1.classification__edition_sk else null end,  u1.url_sha1, ts_vector from xo.xo__sw__agg__url u1 inner join xo.xo__news_in_greek u2 on (u1.url=u2.url) where not u1.buzz_p  and (u1.train_topic_p or u1.train_edition_p) and u1.creation_date > current_timestamp-'3 days'::interval) union all (select case when u1.train_topic_p then u1.classification__tree_sk else null end, case when u1.train_edition_p then u1.classification__edition_sk else null end, case when u1.creation_date > current_timestamp - '3 days'::interval then u1.classification__tree_sk else null end, case when u1.creation_date > current_timestamp - '3 days'::interval then u1.classification__edition_sk else null end,  u1.url_sha1, ts_vector from xo.xo__sw__agg__url u1 inner join xo.xo__news_in_greek u2 on (u1.url=u2.url) where not u1.buzz_p  and permanent_train_p)) training_set;" -o /web/data/news/tmp/tc.psv newsdb
