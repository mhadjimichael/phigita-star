
// TODO: window.onerror handler - see base-debug.js
// TODO: api_key needs to be generated by JS mechanism in 20-xo/00-utils/30-JS-procs.tcl
// Then www/log.tcl would verify each log request before logging the error.
//xo['api_key']= 'aebc-asdf-efas-eads';
xo['api_key']= '';

// see errorception: http://www.youtube.com/watch?v=Eidlz-3CxcM
window.onerror = function myErrorHandler(errorMsg, url, line) {

    var err = {
	'api_key':xo['api_key'],
	'msg':errorMsg,
	'url':url,
	'line':line,
	'referrer' : document.referrer,
	'user_agent' : xo._userAgent,
	'platform' : xo._platform,
	'language' : xo._language,
	'cookie_enabled' : xo._cookieEnabled,
	'screen_width' : xo._screen.width,
	'screen_height' : xo._screen.height
    };
    xo.error(err);

    if (window.XMLHttpRequest) {
	var xhr = new XMLHttpRequest();
	var scripturl = "http://www.phigita.net/log";
	xhr.open("POST", scripturl);
	xhr.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
	var log = '';
	for (var i in err) 
	    log += i + '=' + encodeURIComponent(err[i]) + '&';
	xhr.send(log);
  }


    // prevent the firing of the default event handler
    return true;
}

